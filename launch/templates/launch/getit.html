<!doctype html>
<html>
<head>
    <title>Get It</title>
    <meta charset="utf-8">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700,500' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <style>
html, body{
    font-family: 'Roboto', sans-serif;
    color: #E1BEE7;
    background: #7B1FA2;
    font-size: 6.2vw;
    padding: 0;
    margin: 0;

  -webkit-touch-callout: none; /* iOS Safari */
  -webkit-user-select: none;   /* Chrome/Safari/Opera */
  -khtml-user-select: none;    /* Konqueror */
  -moz-user-select: none;      /* Firefox */
  -ms-user-select: none;       /* IE/Edge */
  user-select: none;       
}
        
div {
    color: #E1BEE7;
    background: #7B1FA2;
}
        
::-webkit-scrollbar {
    display: none;
}
.strokeme
{
    color: #9C27B0;
}

.fit {
  width: 100vw;   
}

.left {
  width: 50%;
  max-height: 100%;
}
        
.imageblock {
    text-align:center;
    position:relative;
    display:block;
    height: 45vw;
    width: 100vw;
    overflow: hidden;
    margin:0;
    padding:0;
}

.imageblock.mobile {
   height:100%;
   max-height: 100vh;
}
        
.center {
  display: block;
  position: relative;
  top: -10vw;
}

.center.mobile {
  top :0vw;
}


.badge {
    height: 80px;
    position: absolute;
    bottom: 20px;
    right: 20px;    
}

.interstitial {
   background: #7B1FA2;
    padding-top: 2vw;
   min-height: 24vw;
   font-size: 1.6vw;
    text-align: center;

}

.detail {
   position:relative;
   background: #7B1FA2;
   color:#E1BEE7;
   font-size: 1.6vw;
   display:block;
   width : 100vw;
   min-height: 24vw;
    text-align:center;
}

.detail.mobile {
  font-size: 3.2vw;
  min-height:60vw;
}


.topDetail {
   background: #7B1FA2;
   color:#E1BEE7;
   font-size: 1.6vw;
   display:block;
   width : 100vw;
   min-height: 24vw;
    text-align:center;
}

.topDetail.mobile {
  font-size: 3.2vw;
  min-height:60vw;
}

        
        h {
           font-size: 4vw;
            color: #FF5252;
        }


.mobile h {
  font-size: 8vw;
}
        
        .detail h {
            position: relative;
            top: 8vw;
        }

.detail.mobile h {
//	top: 12vw;
}

.right {
   float:right;
//   position:absolute;
   width: 32vw;
    padding-top:2vw;
    padding-right: 16vw;
   display:block;
   text-align:left;
}
.mobile .right {
    width: 40vw;
    padding-right: 8vw;
}

.left {
   width:36vw;
    padding-left: 12vw;
   display:block;
   left:0;
   text-align:center;
   float:left;
}

.mobile .left {
    width:48vw;
    padding-left:0vw;
}

#getitButton {
    background:#FF5252;
    color: #7B1FA2;
    font-size: 5vw;
    text-align:center;
    padding:1.25vw;
    margin: 2vw;
//    left:50%;
//    min-width:0;
    display: inline-block;
    cursor:pointer;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

#getitButton.mobile {
   font-size: 10vw;
   padding:2.5vw;
}

.google_badge {
    height: 80px;
    position: absolute;
    bottom: 20px;
    right: 320px;
}
    </style>
</head>
<body>
 <div class="topDetail">   
<div>
<h>It's as simple as pushing a button</h>
</div>
<div id="getitButton">GET IT</div><br>
        <!--div class="left">
The only catch:<br>Someone needs to give it to you
            </div>
        <div class="right">
    If you've got it, you can give it to someone else
            </div-->
</div> 
    <div class="imageblock">
        <img src="/static/friends.jpg" class="center fit">
        <div style="width:32.5vw;background:#7B1FA2;left:25vw;position:absolute;top:26vw;text-align:left;">
        <span style="display:block;top:0vw;color:transparent;background:url(/static/friends.jpg);background-position:-25vw -36vw;-webkit-background-clip: text;background-size:100vw 66.640vw;">Then you'll <span style="color:#FF5252;">both</span> have it</span>
    </div>
    </div>
<div class="detail">
<div class="left">
<h><i class="material-icons" style="font-size:4vw;top:0.5vw;position:relative;">timer</i><span id="countdown">13d 6h 2m 31s</span></h><br><span style="position:relative;top:8vw;color:#FF5252">until reset</span>
</div>
    <div class="right">
<h3> You can't keep it forever</h3>
If nobody gets it for two weeks <b>it resets</b><br>New people get it, and it's up to them to share it with others<br>The best way to keep it is to <b>give it</b>
    </div>
</div>
    <div class="imageblock">
        <img src="/static/city.jpeg" class="center fit">
        <div style="background:#7B1FA2;left:32vw;position:absolute;top:7vw;">
        <span style="position:relative;top:0vw;color:transparent;background:url(/static/city.jpeg);background-position:-32vw -17vw;-webkit-background-clip: text;background-size:100vw 66.666vw;">How <span style="color:#FF5252;">far</span> can we get it?</span>
    </div>
    </div>

      <div id="map" frameBorder="0" style="display:block;height:24vw;width:100vw">
</div>
    <div style="display:block;padding-left:2vw;height:0;font-size:4vw;position:relative;top:-22vw;background-color:transparent;"><h>{{has_it_count}} people have it</h><br><h>It's traveled {{distance}} miles</h><br><h>In {{minutes}} minutes</h>
</div>
<div class="imageblock">
        <img src="/static/wall.jpg" class="center fit"> 
        <div style="width:45vw;background:#7B1FA2;left:5vw;position:absolute;top:5vw;text-align:left;">
        <span style="display:block;top:0vw;color:transparent;background:url(/static/wall.jpg);background-position:-5vw -4vw;-webkit-background-clip: text;background-size:100vw 66.640vw;">Some of us will get it with ease</span>
    </div>
</div>
<div class="imageblock">
        <img src="/static/sherocks.jpg" class="center fit">
         <div style="background:#7B1FA2;left:2vw;position:absolute;top:1.5vw;">
        <span style="position:relative;top:0vw;color:transparent;background:url(/static/sherocks.jpg);background-position:-2vw -11.5vw;-webkit-background-clip: text;background-size:100vw 66.588vw;">It won't always be <span style="color:#FF5252;">easy</span></span>
    </div>
    </div>
    <div class="detail">
    <h>But what would be the fun in that?</h>
    </div>    
    <div class="imageblock">
        <img src="/static/nature-person-red-woman.jpg" class="center fit">
       <div style="background:#7B1FA2;left:24vw;position:absolute;top:6vw;"><span style="position:relative;color:transparent;background:url(/static/nature-person-red-woman.jpg);background-position:-24vw -16vw;-webkit-background-clip: text;background-size:100vw 66.25vw" class="strokeme">Now go out and <span style="color:#FF5252;">get it</span></span>
       </div>
         <a href="https://play.google.com/store/apps/details?id=com.intension.ping&utm_source=global_co&utm_medium=prtnr&utm_content=Mar2515&utm_campaign=PartBadge&pcampaignid=MKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1"><img class="google_badge" alt="Get it on Google Play" src="https://play.google.com/intl/en_us/badges/images/generic/en-play-badge.png" /></a>
        <a href="https://play.google.com/store/apps/details?id=com.intension.ping&utm_source=global_co&utm_medium=prtnr&utm_content=Mar2515&utm_campaign=PartBadge&pcampaignid=MKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1"><img  class="badge" alt="Get it on Google Play" src="/static/Download_on_the_App_Store_Badge_US-UK_135x40.svg" /></a>
    </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="/static/rebound.min.js"></script>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />

    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

<script>// Get a reference to the logo element.



    var Environment = {
        //mobile or desktop compatible event name, to be used with '.on' function
        TOUCH_DOWN_EVENT_NAME: 'mousedown touchstart',
        TOUCH_UP_EVENT_NAME: 'mouseup touchend',
        TOUCH_MOVE_EVENT_NAME: 'mousemove touchmove',
        TOUCH_DOUBLE_TAB_EVENT_NAME: 'dblclick dbltap',

        isAndroid: function() {
            return navigator.userAgent.match(/Android/i);
        },
        isBlackBerry: function() {
            return navigator.userAgent.match(/BlackBerry/i);
        },
        isIOS: function() {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i);
        },
        isOpera: function() {
            return navigator.userAgent.match(/Opera Mini/i);
        },
        isWindows: function() {
            return navigator.userAgent.match(/IEMobile/i);
        },
        isMobile: function() {
            return (Environment.isAndroid() || Environment.isBlackBerry() || Environment.isIOS() || Environment.isOpera() || Environment.isWindows());
        }
    };

if(Environment.isMobile()) {
	d3.selectAll("#getitButton, .imageblock, .center, .detail").classed("mobile", true);
}

function resizing()  { $("*").css("z-index", 1) }
window.onresize=resizing;
window.orientationchange=resizing;

var el = document.getElementById('getitButton');

// create a SpringSystem and a Spring with a bouncy config.
var springSystem = new rebound.SpringSystem();
var spring = springSystem.createSpring(30, 5);
var xRotSpring = springSystem.createSpring(20, 5);
var yRotSpring = springSystem.createSpring(20, 5);
var colorSpring = springSystem.createSpring(10, 9);
var yRotVal = 0;
var xRotVal = 0;
var scaleVal = 1;

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

    var position;

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(setPosition);
    }

function setPosition(loc) {
	position = loc;
	leafletMap.setView([loc.coords.latitude, loc.coords.longitude], 16);	
}

        var lat = "42.3601";
        var lon = "-71.0589";      

            var leafletMap = L.map('map',
                {
                        maxBounds: [
                                [-89.0, -180.0],
                                [89.0, 180.0]
                        ],
                        minZoom: 2,
			zoomControl: false
                }).setView([lat, lon], 16).on('dblclick', function(e) {
  			window.location.href = '/map/';
		});

        leafletMap.doubleClickZoom.disable();  
	leafletMap.scrollWheelZoom.disable();    
	leafletMap.setZoom(16);

//	L.tileLayer("http://{s}.sm.mapstack.stamen.com/($7b1fa2[@p],(toner-lite,$fff[difference])[exclusion],(toner-hybrid,$ff5252[source-in])[hsl-color])/{z}/{x}/{y}.png").addTo(leafletMap);

            L.tileLayer("http://{s}.sm.mapstack.stamen.com/($7b1fa2[@p],toner-lite[soft-light],$ff5252[difference@p],$ff0000[hsl-saturation@p])/{z}/{x}/{y}.png").addTo(leafletMap);

// Add a listener to the spring. Every time the physics
// solver updates the Spring's value onSpringUpdate will
// be called.
spring.addListener({
  onSpringUpdate: function(spring) {
    var val = spring.getCurrentValue();
    val = rebound.MathUtil
                 .mapValueInRange(val, 0, 1, 1, 0.8);
    scale(el, val);
  }
});

//xRotSpring.addListener({
//  onSpringUpdate: function(spring) {
//    var val = spring.getCurrentValue();
//    val = rebound.MathUtil
//                 .mapValueInRange(val, -1, 1, -20, 20);
//    xRot(el, val);
//  }
//});

yRotSpring.addListener({
  onSpringUpdate: function(spring) {
    var val = spring.getCurrentValue();
    val = rebound.MathUtil
                 .mapValueInRange(val, -1, 1, -20, 20);
    yRot(el, val);
  }
});


colorSpring.addListener({
  onSpringUpdate: function(spring) {
    var val = spring.getCurrentValue();
    var initColor = d3.rgb("#FF5252");
    var targetColor = d3.rgb("#9C27B0");
    var interp = d3.interpolateRgb(initColor, targetColor);
    el.style.backgroundColor = interp(val);
  }
});

/*
function getPosition(element) {
    var xPosition = 0;
    var yPosition = 0;

    while (element) {
        xPosition += (element.offsetLeft - element.scrollLeft + element.clientLeft);
        yPosition += (element.offsetTop - element.scrollTop + element.clientTop);
        element = element.offsetParent;
    }
    return { x: xPosition, y: yPosition };
}
*/
var resetDate;

function updateCountdown() {
	var nowDate = new Date();
	var dateDifference = resetDate - nowDate;
	var seconds = Math.round((dateDifference)/1000);
	var minutes = Math.floor(seconds/60);
	var hours = Math.floor(minutes/60);
	var days = Math.floor(hours/24);
	seconds = seconds % 60;
	minutes = minutes % 60;
	hours = hours % 24;
	$('#countdown').html(days + "d " + hours + "h " + minutes + "m " + seconds + "s ");
	var n = document.createTextNode(' ');
	$('#countdown').append(n);
	setTimeout(function(){n.parentNode.removeChild(n)}, 0);

}

    (function worker() {
  $.ajax({
    url: '/api/get_stats', 
    success: function(data) {
	var resetdateString = data.reset_date;
	resetDate = Date.parse(resetdateString);
    },
    complete: function() {
      setTimeout(worker, 5000);
    }
  });
})();

   (function update() {
	updateCountdown();
      setTimeout(update, 1000);
})();

    

var buttonWidth = el.offsetWidth;

// Listen for mouse down/up/out and toggle the
//springs endValue from 0 to 1.
var drag = d3.behavior.drag();
d3.select("#getitButton").call(drag);

el.onmousedown = function(d) {
//alert("hey");
//console.log(d3.event.x - getPosition(el).x - el.clientWidth/2);
  spring.setEndValue(1);
  colorSpring.setEndValue(1);
//  var xpos = d.clientX - getPosition(el).x - el.clientWidth/2;
//  xRotSpring.setEndValue(2*xpos/el.clientWidth);
//  var ypos = d.clientY - getPosition(el).y - el.clientHeight/2;
//  yRotSpring.setEndValue(-2*ypos/el.clientHeight);

};

el.addEventListener("touchstart", function(e) {
//alert(d.o);
//console.log(d3.event.x - getPosition(el).x - el.clientWidth/2);
  var d = e.changedTouches[0];
  spring.setEndValue(1);
  colorSpring.setEndValue(1);
  var xpos = d.pageX - getPosition(el).x - el.clientWidth/2;
  xRotSpring.setEndValue(2*xpos/el.clientWidth);
  var ypos = d.pageY - getPosition(el).y - el.clientHeight/2;
  yRotSpring.setEndValue(-2*ypos/el.clientHeight);

});

drag.on('drag', function(d) {
//console.log(d3.event.x - getPosition(el).x - el.clientWidth/2);
  spring.setEndValue(1);
  colorSpring.setEndValue(1);
//  var xpos = event.x - getPosition(el).x - el.clientWidth/2;
//  xRotSpring.setEndValue(2*xpos/el.clientWidth);
//  var ypos = event.y - getPosition(el).y - el.clientHeight/2;
//  yRotSpring.setEndValue(-2*ypos/el.clientHeight);

//  if (Math.abs(xpos) > el.clientWidth/2 + 10 || Math.abs(ypos) > el.clientHeight/2 + 10) {
//      resetButton();
//  }

});

drag.on('dragend', function(d) {
  resetButton();
});

function resetButton() {
  spring.setEndValue(0);
  colorSpring.setEndValue(0);
  xRotSpring.setEndValue(0);
  yRotSpring.setEndValue(0);
};

el.addEventListener('mouseout', function() {
  xRotSpring.setEndValue(0);
  yRotSpring.setEndValue(0);
  spring.setEndValue(0);
});

/*window.on('mouseup', function() {
  xRotSpring.setEndValue(0);
  yRotSpring.setEndValue(0);
  spring.setEndValue(0);
});
*/
// Helper for scaling an element with css transforms.
function scale(el, val) {
  el.style.mozTransform =
  el.style.msTransform =
  el.style.webkitTransform =
  el.style.transform = 'scale3d(' +
    val + ', ' + val + ', 1)';
  scaleVal = val;
}

function yRot(el, val) {
//  el.style.mozTransform =
//  el.style.msTransform =
//  el.style.webkitTransform =
//  el.style.transform = 'perspective(50vw) rotateX(' +
//    val + 'deg)';
  yRotVal = val;
}


function xRot(el, val) {
  xRotVal = val;
  el.style.mozTransform =
  el.style.msTransform =
  el.style.webkitTransform =
  el.style.transform = 'perspective(600px) scale3d(' + scaleVal + ', ' + scaleVal + ', 1) rotateX(' + yRotVal + 'deg) rotateY(' +
  xRotVal + 'deg)';
}

</script>
</body>
</html>
